@inherits LayoutComponentBase
@implements IDisposable
@inject ICartService cartService
@inject ILocalStorageService localStorageService
@inject NavigationManager navigationManager
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container">
        <div class="navbar-brand">
            <a  href="#">
                <img src="img/Logo.png alt="tradex logo"/>
            </a>
        </div>

        <button class="navbar-toggler" @onclick="ToggleIconMenu" type="button">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse justify-content-center" style="@IconMenuCssClass">
            <ul class="navbar-nav navbar-centered">
                <li class="nav-item">
                    <NavLink class="nav-link custom-nav-link" href="/">Home</NavLink>
                </li>
                <li class="nav-item">
                    <NavLink class="nav-link custom-nav-link" href="/products">Shop</NavLink>
                </li>
                <li class="nav-item">
                    <NavLink class="nav-link custom-nav-link" href="/manage-categories">Category</NavLink>
                </li>
                <li class="nav-item">
                    <NavLink class="nav-link custom-nav-link" href="https://docs.microsoft.com/aspnet/" target="_blank">About Us</NavLink>
                </li>
                <li class="nav-item">
                    <NavLink class="nav-link custom-nav-link" href="#">Blog</NavLink>
                </li>
                <li class="nav-item">
                    <NavLink class="nav-link custom-nav-link" href="#">Contact</NavLink>
                </li>
            </ul>
        </div>

        <div class="navbar-right">
            <a href="#" @onclick="NavigateToCart">
                <span class="material-symbols-outlined">search</span>
            </a>
            <a href="/cart">
                <span class="material-symbols-outlined">shopping_cart</span>
            </a>
            <a href="login">
                <span class="material-symbols-outlined">person</span>
            </a>
        </div>
    </div>
</nav>

@code {
    private bool _iconMenuActive;
    private string? IconMenuCssClass => _iconMenuActive ? "display: block;" : "display: none;";
    int ServiceCountProduct;

    protected void ToggleIconMenu()
    {
        _iconMenuActive = !_iconMenuActive;
    }

    protected override async Task OnInitializedAsync()
    {
        cartService.OnChange += StateHasChanged;
        var myCartItems = await localStorageService.GetItemAsync<List<MyCartModel>>("MyCart");
        ServiceCountProduct = myCartItems?.Count ?? 0;
    }

    public void Dispose()
    {
        cartService.OnChange -= StateHasChanged;
    }

    private void NavigateToCart()
    {
        navigationManager.NavigateTo("/cart");
    }
}